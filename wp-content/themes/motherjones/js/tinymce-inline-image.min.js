tinymce.PluginManager.add("wpgallery",function(a){function b(a){return wp.shortcode.replace("inline_image",a,c)}function c(a){var b=wp.shortcode.replace("caption",a.content,d),c=a.attrs.named.id?'id="'+a.attrs.named.id+'"':"";return"<figure "+c+' class="inline-image align'+a.attrs.named.align+'" style="max-width: '+a.attrs.named.width+'px;">'+b+"</figure>"}function d(a){var b=wp.shortcode.replace("credit",a.content,e);return'<figcaption class="wp-caption-text"><span class="media-caption">'+b+"</span></figcaption>"}function e(a){return'</span> <span class="media-credit">'+a.content}function f(a){var b=jQuery("<div>"+a+"</div>");return b.find("figure.inline-image").replaceWith(g),b.html()}function g(){var a=jQuery(this),b=(jQuery(a[0]),a.attr("id")?'id="'+a.attr("id")+'"':""),c=/align([a-zA-Z]+)/.exec(a.attr("class"))[1],d=/([0-9]+)/.exec(a.attr("style"))[1],e=a.find("img").prop("outerHTML"),f=a.find("span.media-credit"),g=f.html()?"[credit]"+f.html()+"[/credit]":"",h=a.find("span.media-caption"),i=h.html()?"[caption]"+h.html()+g+"[/caption]":g;return"[inline_image "+b+' align="'+c+'" width="'+d+'"]'+e+i+"[/inline_image]"}a.on("BeforeSetContent",function(a){a.content=b(a.content)}),a.on("PostProcess",function(a){a.get&&(a.content=f(a.content))})});